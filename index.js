
const functions = require('firebase-functions');
const admin = require('firebase-admin');
import * as functions from 'firebase-function';
import * as admin from 'firebase-admin';
admin.initializeApp();
const db = admin.firestore;
const fcm = admin.messaging(); 
export const sendToDevice = functions.firestore
.document('Orders/{orderId}')
.onCreate(async snapshot => {
    const order = snapshot.data();
    const querySnapshot = await db
    .collection('users')
    .doc(order.mobileNumber)
    .collection('tokens')
    .get();
    const tokens = querySnapshot.docs.map(snap => snap.id);
    var payload={
    notification:{
        title: 'New order received',
        body: 'You have received a new order',
        sound: 'Default',
        icon:'data:image/png;base64,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',
    },
        data: {click_Action = FLUTTER_NOTIFICATION_CLICK, message: 'Foodly' },
};
    try{
        const response = await admin.messaging().sendToDevice(tokens,payload);
        console.log('Notification sent successfully');
    }

    catch(err){
    console.log('error sending notification');

    }
    
}

);

